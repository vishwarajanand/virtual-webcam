<html>

<head>
  <title>Virtual Webcam Demo Website</title>
  <script>
    const filterSettingKey = "FilterSettingKey";
    const default_value = "shader-raw";

    function setUserPrefs(val) {
      sessionStorage.setItem(filterSettingKey, val);
      getUserPrefs();
      console.log(`Set preferred filter to : ${val}`);
      resetVideo();
    }

    function getUserPrefs() {
      let filterSettingValue = sessionStorage.getItem(filterSettingKey);
      console.log(`Got preferred filter : ${filterSettingValue}`);
    }

    function resetVideo() {
      let video = document.getElementById("video");
      video.remove();
      // init(); // says init not defined!
      document.location.reload();
    }

    // getUserPrefs();
    // resetVideo();
    // storeUserPrefs(default_value);
  </script>
  <script type="module">
    import { monkeyPatchMediaDevices } from './js/media-devices.js';

    monkeyPatchMediaDevices();

    async function init() {
      const res = await navigator.mediaDevices.enumerateDevices();
      console.log(res);
      const stream = await navigator.mediaDevices.getUserMedia({ video: { deviceId: 'virtual' }, audio: false });
      const video = document.createElement('video');
      video.id = "video";
      video.srcObject = stream;
      video.autoplay = true;
      document.body.append(video);
    }

    init();
  </script>
</head>

<body>
  <img src='./icons/icon-16.png' id='extensionImage'>
  <button id='VirtualWebcamExtension_ShowSample' onclick="setUserPrefs(default_value)">Remove Filters (default)</button>
  <button id='VirtualWebcamExtension_ShowBW' onclick="setUserPrefs('shader-bw')">Black and White Filter</button>
  <button id='VirtualWebcamExtension_ShowFlicker' onclick="setUserPrefs('shader-flicker')">Flicker</button>
  <script src="js/settings.js"></script>
  <br />
  <br />
</body>

</html>